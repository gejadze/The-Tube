/* * The Tube * Designed for Chrome APP * * Copyright 2011, Nick Gejadze * Released under GPL Licenses. * * Date: 05/28/2011 */var yapi={top_rated:"http://gdata.youtube.com/feeds/api/standardfeeds/top_rated?alt=jsonc&v=2&max-results=24",top_favorites:"http://gdata.youtube.com/feeds/api/standardfeeds/top_favorites?alt=jsonc&v=2&max-results=24",most_viewed:"http://gdata.youtube.com/feeds/api/standardfeeds/most_viewed?alt=jsonc&v=2&max-results=24",most_shared:"http://gdata.youtube.com/feeds/api/standardfeeds/most_shared?alt=jsonc&v=2&max-results=24",most_popular:"http://gdata.youtube.com/feeds/api/standardfeeds/most_popular?alt=jsonc&v=2&max-results=24",most_recent:"http://gdata.youtube.com/feeds/api/standardfeeds/most_recent?alt=jsonc&v=2&max-results=24",most_discussed:"http://gdata.youtube.com/feeds/api/standardfeeds/most_discussed?alt=jsonc&v=2&max-results=24",most_responded:"http://gdata.youtube.com/feeds/api/standardfeeds/most_responded?alt=jsonc&v=2&max-results=24",recently_featured:"http://gdata.youtube.com/feeds/api/standardfeeds/recently_featured?alt=jsonc&v=2&max-results=24",tranding_videos:"http://gdata.youtube.com/feeds/api/standardfeeds/on_the_web?alt=jsonc&v=2&max-results=24",init:function(){yapi.body=$('body');if(yapi.getUser()){yapi.buildLayout();yapi.buildHeader();if(yapi.username==0){yapi.buildFrontContent(yapi.most_popular);}else{yapi.buildUserContent();}yapi.buildFooter();}},getUser:function(){if(localStorage["username"]){yapi.username=localStorage["username"];return true;}else{yapi.setupApplication();return false;}},setupApplication:function(){yapi.startup=$('<div/>',{id:"startup"});yapi.logoImage=$('<img/>',{id:"logoImage",src:"images/logo.png"}).appendTo(yapi.startup);yapi.welcome=$('<div/>',{id:"welcome"}).html("Howdy!<br >Please enter your Youtube username:<br />").appendTo(yapi.startup);yapi.userform=$('<form/>',{id:"user_form"}).appendTo(yapi.startup);yapi.userinput=$('<input/>',{id:"username",type:"text"}).addClass("usernameInput").appendTo(yapi.userform);yapi.gobutton=$('<a/>',{href:"#",rel:"go"}).html("Go!").addClass("button").appendTo(yapi.startup);yapi.skipbutton=$('<a/>',{href:"#",rel:"skip"}).html("Skip").addClass("button").appendTo(yapi.startup);yapi.buildModal(yapi.startup);},setUser:function(user){localStorage["username"]=user;yapi.init();},enterUsername:function(){localStorage.clear();window.location.reload();yapi.init();},buildModal:function(message){yapi.height=$(document).height();yapi.width=$(window).width();if(!yapi.ovarlay){yapi.ovarlay=$('<div/>',{id:"overlay"}).appendTo(yapi.body);yapi.ovarlay.css({height:yapi.height,width:yapi.width});}if(!yapi.modal){var modalTop=(yapi.height/3);var modalLeft=(yapi.width/2-200);yapi.modal=$('<div/>',{id:"modal"}).appendTo(yapi.body);yapi.modal.css({top:modalTop,left:modalLeft});}yapi.modal.hide();yapi.modal.append(message).fadeIn(1500);},buildLayout:function(){yapi.body.empty();yapi.wrapper=$('<div/>',{id:"wrapper"}).appendTo(yapi.body);yapi.header=$('<div/>',{id:"header"}).appendTo(yapi.wrapper);yapi.content=$('<div/>',{id:"content"}).appendTo(yapi.wrapper);yapi.footer=$('<div/>',{id:"footer"}).appendTo(yapi.wrapper);},buildHeader:function(){yapi.logo=$('<div/>',{id:"logo"}).appendTo(yapi.header);yapi.logoLink=$('<a/>',{href:"http://www.youtube.com",rel:"logo"}).addClass("logo").appendTo(yapi.logo);yapi.logoImage=$('<img/>',{id:"logoImage",src:"images/logo.png"}).appendTo(yapi.logoLink);yapi.search=$('<div/>',{id:"search"}).appendTo(yapi.header);yapi.searchForm=$('<form/>',{id:"searchForm",action:"#"}).appendTo(yapi.search);yapi.searchInput=$('<input/>',{type:"text",id:"searchInput"}).appendTo(yapi.searchForm);yapi.searchButton=$('<input/>',{type:"submit",value:"Search",id:"searchButton"}).appendTo(yapi.searchForm);if(yapi.username!=0){yapi.usernamedisplay=$('<div/>',{id:"usernamedisplay"}).html(yapi.username);yapi.usernamedisplay.appendTo(yapi.searchForm);}yapi.header.append("<hr />");},buildFrontContent:function(url){yapi.buildFeed(url);yapi.buildRightSide();},buildUserContent:function(){yapi.buildUserPlaylists();yapi.buildUserFeeds();yapi.buildRightSide();},buildFooter:function(){yapi.footerLeft=$('<div/>',{id:"footerleft"});yapi.footerRight=$('<div/>',{id:"footerright"});yapi.authlink=$('<a/>',{id:"userauth",href:"#userauth"});if(yapi.username==0){yapi.authlink.html("Enter Username")}else{yapi.authlink.html("Reset Username");}yapi.authlink.appendTo(yapi.footerLeft);yapi.youtubeLogoLink=$('<a/>',{href:"http://youtube.com"});yapi.youtubeLogo=$('<img/>',{src:"images/yt_powered_by_black.png",id:"youtubelogo"}).appendTo(yapi.youtubeLogoLink);yapi.youtubeLogoLink.appendTo(yapi.footerRight);yapi.footerLeft.appendTo(yapi.footer);yapi.footerRight.appendTo(yapi.footer);},buildFeed:function(url){yapi.feed=$('<div/>',{id:'feed'}).html("Loading...");yapi.feed.appendTo(yapi.content);xhr=$.ajax({type:"GET",url:url,dataType:"jsonp"}).success(function(response){if(response.data.items){yapi.feed.empty().html("<h4>Most Popular Videos</h4>");$.each(response.data.items,function(i,data){item=$('<div/>').addClass('item');itemFrame=$('<div/>').addClass('itemFrame');itemFrameThumbnail=$('<img/>',{src:data.thumbnail.sqDefault});itemlink=$('<a/>',{href:"#"+data.id,rel:data.id}).addClass("videoThumb").appendTo(itemFrame);itemFrameThumbnail.appendTo(itemlink);itemFrame.appendTo(item);item.append(yapi.trunc(data.title,30,true));if(data.viewCount){multiple=(data.viewCount>1)?"s":"";item.append("<br />"+data.viewCount+" View"+multiple);}else{item.append("<br />0 View");}yapi.feed.append(item);});}});},buildUserPlaylists:function(){yapi.playlists=$('<div/>',{id:'playlists'}).html("Loading Playlists...");yapi.playlists.appendTo(yapi.content);xhr=$.ajax({type:"GET",url:"http://gdata.youtube.com/feeds/api/users/"+yapi.username+"/playlists?v=2&alt=jsonc",dataType:"jsonp"}).success(function(response){if(response.data.items){yapi.playlists.empty().html("<h4>Playlists</h4>");$.each(response.data.items,function(i,playlist){if(i<6){$.ajax({type:"GET",url:"http://gdata.youtube.com/feeds/api/playlists/"+playlist.id+"?v=2&alt=jsonc&max-results=1",dataType:"jsonp"}).success(function(resp){if(resp.data.items){$.each(resp.data.items,function(k,pdata){item=$('<div/>').addClass('item');itemFrame=$('<div/>').addClass('itemFrame');itemlink=$('<a/>',{href:"#"+playlist.id,rel:playlist.id}).addClass("playlistLink").appendTo(itemFrame);itemFrameThumbnail=$('<img/>',{src:pdata.video.thumbnail.sqDefault});itemFrameThumbnail.appendTo(itemlink);itemFrame.appendTo(item);item.append(yapi.trunc(playlist.title,30,true));});}yapi.playlists.append(item);});}});}});},buildPlaylist:function(id){yapi.feed.html("Loading Playlist...");xhr=$.ajax({type:"GET",url:"http://gdata.youtube.com/feeds/api/playlists/"+id+"?v=2&alt=jsonc&max-results=50",dataType:"jsonp"}).success(function(response){if(response.data.items){yapi.feed.empty().html("<h4>Favorites</h4>");$.each(response.data.items,function(i,dataitems){var data=dataitems.video;item=$('<div/>').addClass('item');itemFrame=$('<div/>').addClass('itemFrame');itemFrameThumbnail=$('<img/>',{src:data.thumbnail.sqDefault});itemlink=$('<a/>',{href:"#"+data.id,rel:data.id}).addClass("videoThumb").appendTo(itemFrame);itemFrameThumbnail.appendTo(itemlink);itemFrame.appendTo(item);item.append(yapi.trunc(data.title,30,true));if(data.viewCount){multiple=(data.viewCount>1)?"s":"";item.append("<br />"+data.viewCount+" View"+multiple);}else{item.append("<br />0 View");}yapi.feed.append(item);});}});},buildUserFeeds:function(){yapi.feed=$('<div/>',{id:'feed'}).html("Loading favorites...");yapi.feed.appendTo(yapi.content);xhr=$.ajax({type:"GET",url:"http://gdata.youtube.com/feeds/api/users/"+yapi.username+"/favorites?v=2&alt=jsonc&max-results=50",dataType:"jsonp"}).success(function(response){if(response.data.items){yapi.feed.empty().html("<h4>Favorites</h4>");$.each(response.data.items,function(i,dataitems){var data=dataitems.video;item=$('<div/>').addClass('item');itemFrame=$('<div/>').addClass('itemFrame');itemFrameThumbnail=$('<img/>',{src:data.thumbnail.sqDefault});itemlink=$('<a/>',{href:"#"+data.id,rel:data.id}).addClass("videoThumb").appendTo(itemFrame);itemFrameThumbnail.appendTo(itemlink);itemFrame.appendTo(item);item.append(yapi.trunc(data.title,30,true));if(data.viewCount){multiple=(data.viewCount>1)?"s":"";item.append("<br />"+data.viewCount+" View"+multiple);}else{item.append("<br />0 View");}yapi.feed.append(item);});}});},buildRightSide:function(){yapi.rightSide=$('<div/>',{id:"rightSide"}).appendTo(yapi.content);yapi.trands=$('<div/>',{id:"trands"}).appendTo(yapi.rightSide);yapi.trands.html("<h4>Trends</h4>");tranding_xhr=$.ajax({type:"GET",url:yapi.tranding_videos,dataType:"jsonp"}).success(function(response){if(response.data.items){$.each(response.data.items,function(i,data){if(i<4){item=$('<div/>').addClass('trands_item');itemFrame=$('<div/>').addClass('trands_itemFrame');itemlink=$('<a/>',{href:"#"+data.id,rel:data.id}).addClass("videoThumb").appendTo(itemFrame);itemFrameThumbnail=$('<img/>',{src:data.thumbnail.sqDefault});itemFrameThumbnail.appendTo(itemlink);itemFrame.appendTo(item);itemInfo=$('<div/>').addClass('trands_info');itemInfo.appendTo(item);itemInfo.append(yapi.trunc(data.title,40,true));if(data.viewCount){multiple=(data.viewCount>1)?"s":"";itemInfo.append("<br />"+data.viewCount+" View"+multiple);}yapi.trands.append(item);}});}});yapi.featured=$('<div/>',{id:"featured"}).appendTo(yapi.rightSide);yapi.featured.html("<h4>Featured</h4>");featured_xhr=$.ajax({type:"GET",url:yapi.recently_featured,dataType:"jsonp"}).success(function(response){if(response.data.items){$.each(response.data.items,function(i,data){if(i<4){item=$('<div/>').addClass('featured_item');itemFrame=$('<div/>').addClass('featured_itemFrame');itemFrameThumbnail=$('<img/>',{src:data.thumbnail.sqDefault});itemlink=$('<a/>',{href:"#"+data.id,rel:data.id}).addClass("videoThumb").appendTo(itemFrame);itemFrameThumbnail.appendTo(itemlink);itemFrame.appendTo(item);itemInfo=$('<div/>').addClass('featured_info');itemInfo.appendTo(item);itemInfo.append(yapi.trunc(data.title,30,true));if(data.viewCount){multiple=(data.viewCount>1)?"s":"";itemInfo.append("<br />"+data.viewCount+" View"+multiple);}yapi.featured.append(item);}});}});},viewVideo:function(id){$.ajax({type:"GET",url:"http://gdata.youtube.com/feeds/api/videos/"+id+"?v=2&alt=jsonc",dataType:"jsonp",success:function(response){var data=response.data;if(data){var videoWrapper=$('<div/>',{id:"videoWrapper"});document.title=data.title;var videoTitle=$('<div/>',{id:'videoTitle'}).html("<h4>"+data.title+"</h4>").appendTo(videoWrapper);var videoFrame="<iframe width='960' height='576' src='http://www.youtube.com/embed/"+id+"?fs=1&hl=en_US&rel=0&hd=1;&autoplay=1' frameborder='0' type='text/html'></iframe>";videoWrapper.append(videoFrame);var videoCount=$('<div/>',{id:'videoCount'}).html(data.viewCount+" Views").appendTo(videoWrapper);var description=$('<div/>',{id:'videoDescription'}).html(data.description).appendTo(videoWrapper);yapi.content.empty().append(videoWrapper);yapi.getRelatedVideos(id);}}});},get:function(query){$.ajax({type:"GET",url:"http://gdata.youtube.com/feeds/api/videos?q="+query+"&format=5&max-results=1&v=2&alt=jsonc",dataType:"jsonp",success:function(response){if(response.data.items){$.each(response.data.items,function(i,data){var videoWrapper=$('<div/>',{id:"videoWrapper"});document.title=data.title;var videoTitle=$('<div/>',{id:'videoTitle'}).html("<h4>"+data.title+"</h4>").appendTo(videoWrapper);var videoFrame="<iframe width='960' height='576' src='http://www.youtube.com/embed/"+data.id+"?fs=1&hl=en_US&rel=0&hd=1;&autoplay=1' frameborder='0' type='text/html'></iframe>";videoWrapper.append(videoFrame);var videoCount=$('<div/>',{id:'videoCount'}).html(data.viewCount+" Views").appendTo(videoWrapper);var description=$('<div/>',{id:'videoDescription'}).html(data.description).appendTo(videoWrapper);yapi.content.empty().append(videoWrapper);yapi.getRelatedVideos(data.id);});}}});},getRelatedVideos:function(videoId){yapi.related=$('<div/>',{id:'related'}).html("Loading...");yapi.related.appendTo(yapi.content);xhr=$.ajax({type:"GET",url:"http://gdata.youtube.com/feeds/api/videos/"+videoId+"/related?v=2&alt=jsonc&max-results=6",dataType:"jsonp"}).success(function(response){if(response.data.items){yapi.related.empty().html("<br /><h4>Related Videos:</h4>");$.each(response.data.items,function(i,data){item=$('<div/>').addClass('item');itemFrame=$('<div/>').addClass('itemFrame');itemFrameThumbnail=$('<img/>',{src:data.thumbnail.sqDefault});itemlink=$('<a/>',{href:"#"+data.id,rel:data.id}).addClass("videoThumb").appendTo(itemFrame);itemFrameThumbnail.appendTo(itemlink);itemFrame.appendTo(item);item.append(yapi.trunc(data.title,30,true));if(data.viewCount){multiple=(data.viewCount>1)?"s":"";item.append("<br />"+data.viewCount+" View"+multiple);}else{item.append("<br />0 View");}yapi.related.append(item);});}});},trunc:function(text,n,useWordBoundary){var toLong=text.length>n,s_=toLong?text.substr(0,n-1):text;s_=useWordBoundary&&toLong?s_.substr(0,s_.lastIndexOf(' ')):s_;return toLong?s_+'...':s_;}}var delay=(function(){var timer=0;return function(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms);};})();$(function(){var css=$('<link/>',{href:'css/yapi.css',rel:'stylesheet',type:'text/css'}).appendTo('head');yapi.init();focus();$("#searchInput").live('keyup',function(e){var searchInput=$(this).val();var key=(e.keyCode?e.keyCode:e.which);if(key>64&&key<=127||key==8){delay(function(){if(searchInput.length>0){yapi.get(encodeURIComponent(searchInput));focus();}else if(searchInput.length==0){yapi.init();focus();}},500);}});$(".videoThumb").live('click',function(){var id=$(this).attr("rel");yapi.viewVideo(id);focus();});$(".logo").live('click',function(){yapi.init();focus();return false;});$(".playlistLink").live('click',function(){var playlistId=$(this).attr("rel");yapi.buildPlaylist(playlistId);return false;});$("#userauth").live('click',function(){yapi.enterUsername();return false;});$(".button").live('click',function(){var action=$(this).attr("rel");switch(action){case"skip":yapi.setUser(0);break;case"go":var username=$("#username").val();if(username.length>0){yapi.setUser(username);}else{yapi.setUser(0);}break;}return false;});$("#user_form").submit(function(){var username=$("#username").val();if(username.length>0){yapi.setUser(username);}else{$("#login_error").remove();var login_error=$("<div/>",{id:"login_error"}).html("<br />Please enter username or click the skip button!");yapi.startup.append(login_error);}return false;});function focus(){$("#searchInput").focus();}});